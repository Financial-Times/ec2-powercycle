machine:
  environment:
    AWS_DEFAULT_REGION: eu-west-1
    AWS_LAMBDA_FUNCTION: ec2-powercycle
  
test:
  post:
    - chmod 755 sh/*.sh

deployment:
  master:
    branch: master
    commands:
      - ./sh/package.sh
      - ./sh/lambda-deploy-latest.sh --file ec2-powercycle.zip    
      - ./sh/lambda-invoke-function.sh --function ec2-powercycle --dryrun true
  release:
    tag: /release-.*/
    commands:
      - ./sh/lambda-publish-version.sh
      - ./sh/lambda-update-alias.sh --function ec2-powercycle --alias PROD   